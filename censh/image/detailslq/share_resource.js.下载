/**
 * Created by Administrator on 2018/1/30.
 */
$(function () {
    /*商品比较相关js*/
    $.initCompare = function () {
        var m = this;
        var compare_list = new Array();
        if ($.cookie('compare_list')) {
            compare_list = $.cookie('compare_list').split('-');
        }
        m.compare_list = compare_list;
        var max_compare_limit = 3;
        m.max_compare_limit = max_compare_limit;

        //右侧浮动层赋初始值，含图片
        m.initRightFloatingCompareHtml = function () {
            if ($('.suspend .compare-box').length > 0) {
                $.ajax({
                    dataType: 'JSONP',
                    url: baseUrl+'product/getCurrentCompareList',
                    success: function (response) {
                        var dataObj = response;
                        //console.log(dataObj);
                        $('.watch-compare .compare-box li').each(function () {
                            $(this).html('<a href="'+baseUrl+'watch/"><i></i><p>添加</p></a>');
                        });
                        if (!$.isEmptyObject(dataObj)) {
                            $.each(dataObj, function (i, n) {
                                var pkidStr = "'"+n.pkid+"'";
                                var li_html = '<a href="javascript:;"><img src="' + n.image_url + '" width="80" height="80" alt=""  onerror="imgError(this);"/></a>' +
                                    '<a class="close" href="javascript:;" onclick="window.Compare.removeCompare(' + pkidStr + ')"></a>';
                                $('.watch-compare .compare-box li:eq(' + i + ')').html(li_html);
                            });
                        }
                    },
                    error: function (response) {

                    }
                });
            }
        };

        m.removeCompare = function (pkid) {
            var index = $.inArray(pkid, m.compare_list);
            m.compare_list.splice(index, 1);
            $.cookie('compare_list', m.compare_list.join('-'), {
                expires: 7,
                path: '/'
            });
            m.initRightFloatingCompareHtml();
        };
    };

    $(document).ready(function () {
        window.Compare = new $.initCompare();
        window.Compare.initRightFloatingCompareHtml();
    });

    /*侧边栏*/
    function suspendHover(dom1,dom2) {
        $(dom1).on("mouseenter", function () {
            $(dom2).show();
            $(dom1+'>em').show();
        }).on("mouseleave", function () {
            $(dom2).hide();
            $(dom1+'>em').hide();
        })
    }
    suspendHover("censhfix .watch-compare", "censhfix .compare-box");
    suspendHover("censhfix .QR-code", "censhfix .QR-code-img");
});

function imgError(image, type){
    if(!type){
        type = 'product';
    }
    $(image).attr('src', baseUrl+'media/default-'+type+'.png');
}